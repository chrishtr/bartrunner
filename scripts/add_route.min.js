/*
 *
 *  Bart Runner Web - Details Screen
 *  Copyright 2018 Google Inc. All rights reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the 'License');
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an 'AS IS' BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License
 *
 */
(function() {
'use strict';

class BartRunnerAddRoute {
  constructor(root) {
    this.root_ = root;
    this.fromStation_ = root.querySelector('#from-station');
    this.toStation_ = root.querySelector('#to-station');
    this.statusGroup_ = root.querySelector('#status');
    if (!this.fromStation_ || !this.toStation_ || !this.statusGroup)
      throw "Unable to locate UI elements";

    // Update both sets of station selectors
    this.addStationsTo(this.fromStation_);
    this.addStationsTo(this.toStation_);
  }

  get root() {
    return this.root_;
  }
  get fromStation() {
    return this.fromStation_;
  }
  get toStation() {
    return this.toStation_;
  }
  get statusGroup() {
    return this.statusGroup_;
  }

  addToLog(newMsg) {
    BartRunnerUtils.addToLog(this,newMsg)
  }

  addStationsTo(selector) {
    if (!selector)
      return;

    var that = this;
    BartRunnerUtils.requestBartApi('stn','stns')
      .then(function(data) {
        let stationList = data.root.stations.station;
        selector.innerHTML = '';
        stationList.forEach(stn => {
          let newItem = document.createElement('option');
          newItem.value = stn.abbr;
          newItem.innerHTML = stn.name;
          selector.appendChild(newItem);
        });
      })
      .catch(function(err) {
        if (err.statusText)
          err=err.statusText;
        that.addToLog('error accessing stations: ' + err);
      });
  }
};

window.addEventListener('load', function() {
  const obj = new BartRunnerAddRoute(document.getElementById('main-app-add-route'));
});
})();
